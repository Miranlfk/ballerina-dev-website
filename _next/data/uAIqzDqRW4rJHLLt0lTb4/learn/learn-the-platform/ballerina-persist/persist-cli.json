{"pageProps":{"frontmatter":{"layout":"ballerina-persist-documentation-left-nav-pages-swanlake","title":"Persist CLI tool","description":"The sections gives details on the Persist CLI tool.","keywords":"ballerina, programming language, ballerina packages, persist, persist cli tool, persist init, persist generate, persist migrate","permalink":"/learn/ballerina-persist/persist-cli/","active":"persist_cli","intro":"One of the main components of the `bal persist` feature is the CLI tool. This tool is used to initialize the project with bal persist and generate the required files.","redirect_from":["/learn/ballerina-persist/persist-cli/"]},"content":"\n## Initialize bal persist in the project.\n\nThe Ballerina project should be initialized with `bal persist` before generating the derived types, clients, and script files. This can be done using the `init` command. You can specify the preferred data store and the module which you need to generate files. If you do not specify the data store and the module, the default values will be used.\n\n```bash\n$ bal persist init --datastore=\"mysql\" --module=\"store\"\n```\n\n| Command Parameter  |                                                     Description                                                      | Mandatory  |       Default Value        |\n|:------------------:|:--------------------------------------------------------------------------------------------------------------------:|:----------:|:--------------------------:|\n|     datastore      | used to indicate the preferred data store. Currently, three data stores are supported: inmemory, mysql, googlesheets |     No     |          immemory          |\n|       module       |                    used to indicate the persist enabled module in which the files are generated.                     |     No     |       <root_module>        |\n\n\nThe command initializes `bal persist` feature in the project. This command will do the following,\n\n1. Create persist directory in the project root directory.\n   This directory contains the data model definition file(model.bal) of the project.\n   \n2. Create a model definition file in persist directory\n   This file is used to model the data which need to be persisted in the project. You can have only one data model definition file in the project and file name can be anything with the `.bal` extension. The default file name is `model.bal`. Entities defined in this file should be based on the [`persist model` specification](persist_model.md).\n\n3. Update the `Ballerina.toml` file with persist module configurations.\n   It will update the Ballerina.toml file with persist configurations, as follows,\n    ```ballerina\n    [persist]\n    datastore = \"mysql\"\n    module = \"rainier.store\"\n   ```\n\nThe directory structure will be,\n```\nrainier\n   ├── persist\n            └── model.bal\n   ├── Ballerina.toml\n   └── main.bal\n```\n\nBehaviour of the `init` command,\n- User should invoke the command within a Ballerina project\n- User can use the optional arguments to indicate the preferred module name and data store, otherwise default values will be used.\n- User cannot execute the command multiple times within the same project. User needs to remove the Ballerina.toml configurations, if the user wants to reinitialize the project.\n\n## 3. Generating derived Types, client, and script files\n\nThis command is used to generate the derived types, clients, and script files based on the data model definition file. This command is executed in the project root directory, as follows,\n\n```bash\n$ bal persist generate\n```\n\nIt will add generated files under the `generated` directory. The directory structure will be as follows,\n\nIf the module name is provided, it will generate the files under a new subdirectory with the module name like below. Otherwise, it will generate the files under the `generated` directory.\n\n```\nrainier\n   ├── generated\n        └── store\n              ├── persist_client.bal\n              ├── persist_db_config.bal\n              ├── persist_types.bal\n              └── script.sql\n   ├── persist\n        └── model.bal\n   ├── Ballerina.toml\n   ├── Config.toml\n   └── main.bal\n```\n\n* The `persist_types.bal` file will contain the derived types based on the entities defined in the model definition file. \n\n* The `persist_client.bal` file will contain the client which is used to access the data store.\n\n* The `persist_*_config.bal` file will contain the configurable variables required for the data store access. The configurable variables are changed based on the data store specified in the `Ballerina.toml` file. For example, if the data store is `mysql`, the configurable variables will be as follows.\n\n```ballerina\nconfigurable string host = ?;\nconfigurable int port = ?;\nconfigurable string user = ?;\nconfigurable string password = ?;\nconfigurable string database = ?;\n```\n\n* The script file(script.sql) will contain the scripts to create the tables in the data store. This script file will be generated based on the data store specified in the `Ballerina.toml` file.\n\nAdditionally, this command will create/update `Config.toml` file with configurables used to connect the client with the data store. Generated configurables will be based on the data store specified in the `Ballerina.toml` file.\n\nBehaviour of the `generate` command,\n- User should invoke the command within a Ballerina project\n- The user should have initiated `bal persist` feature in the project and update the model definition file.\n- The model definition file should contain the `persist` module import (`import ballerina/persist as _;`)\n- The Model definition file should contain at least one entity\n- If the user invokes the command twice, it will not fail. It will regenerate the files again.\n\n## Generating Migration scripts for the Model Definition Changes[Experimental]\n\n>**Info:** The support for migrations is currently an experimental feature, and its behavior may be subject to change in future releases. Also, the support for migrations is currently limited to MySQL data store.\n\nThis command is used to generate the migration scripts for the model definition changes. This command is executed in the project root directory. This command will generate the migration scripts based on the changes in the model definition file. The generated migration scripts will be added to the `migrations` directory inside the `persist` directory.\n\n```bash\n$ bal persist migrate add_employee\n```\n\nThe file structure of the project after executing the command will be as follows,\n\n```\nrainier\n   ├── generated\n         └── store\n               ├── persist_client.bal\n               ├── persist_db_config.bal\n               ├── persist_types.bal\n               └── script.sql\n   ├── persist\n         └── model.bal\n         └── migrations\n               └── 20200820120000_add_employee\n                  ├── model.bal\n                  └── script.sql     \n   ├── Ballerina.toml\n   ├── Config.toml\n   └── main.bal\n```\n\nThis command will create a new directory for the migration with the timestamp and the label provided by the user. The directory will contain the model definition file and the script file. The script file will contain the SQL script to update the database schema. The model definition file will be the snapshot of the model definition file at the time of executing the command. The next time the user executes the command, it will compare the model definition file with the latest snapshot file and generate the SQL script to update the database schema. So the user should not modify the snapshot file.\n\nBehaviour of the `migrate` command,\n- User should invoke the command within a Ballerina project\n- User should provide a valid label for the migration.\n- The user should have initiated `bal persist` in the project and update the model definition file.\n- The user can execute the command multiple times. It will generate the migration scripts based on the changes in the model definition file.\n- Once the migration is generated, the user cannot change the data store type in the `Ballerina.toml` file. If the user wants to change the data store type, the user needs to remove the migration directory and reinitialize the project.\n","id":"persist-cli","sub":"ballerina-persist","third":"","slug":"ballerina-persist/persist-cli","codes":"[[-208908821,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">$</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">bal</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">persist</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">init</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--datastore=</span><span style=\\\"color: #032F62\\\">&quot;mysql&quot;</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--module=</span><span style=\\\"color: #032F62\\\">&quot;store&quot;</span></span></code></pre>\"],[-1349379598,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">[persist]</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">datastore </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;mysql&quot;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">module</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">&quot;rainier.store&quot;</span></span></code></pre>\"],[-1483786128,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">$</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">bal</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">persist</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">generate</span></span></code></pre>\"],[-1843748185,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">configurable</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> host </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">?</span><span style=\\\"color: #24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">configurable</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">int</span><span style=\\\"color: #24292E\\\"> port </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">?</span><span style=\\\"color: #24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">configurable</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> user </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">?</span><span style=\\\"color: #24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">configurable</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> password </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">?</span><span style=\\\"color: #24292E\\\">;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">configurable</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">string</span><span style=\\\"color: #24292E\\\"> database </span><span style=\\\"color: #D73A49\\\">=</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">?</span><span style=\\\"color: #24292E\\\">;</span></span></code></pre>\"],[554504028,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">$</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">bal</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">persist</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">migrate</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">add_employee</span></span></code></pre>\"]]"},"__N_SSG":true}