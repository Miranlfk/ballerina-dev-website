{"pageProps":{"frontmatter":{"layout":"ballerina-cloud-left-nav-pages-swanlake","title":"AWS Lambda","description":"Learn how to write and deploy AWS Lambda functions using Ballerina.","keywords":"ballerina, programming language, serverless, cloud, aws, lambda, cloud native","permalink":"/learn/run-ballerina-programs-in-the-cloud/function-as-a-service-with-ballerina/aws-lambda/","active":"aws-lambda","intro":"AWS Lambda is an event driven, serverless computing platform."},"content":"\nThe AWS Lambda extension provides the functionality to expose a Ballerina function as an AWS Lambda function. Ballerina functions can be deployed in AWS Lambda by annotating a Ballerina function with `@awslambda:Function`, which should have the `function (awslambda:Context, json|EventType) returns json|error` function signature.\n\n## Supported triggers\nAn AWS Lambda function can be triggered by various AWS services. You can find the list of supported notification types below.\n\n- Direct Invocation\n- Simple Queue Service <a href=\"https://aws.amazon.com/sqs/\" target=\"_blank\">SQS</a>\n- Simple Storage Service <a href=\"https://aws.amazon.com/s3/\" target=\"_blank\">S3</a>\n- <a href=\"https://aws.amazon.com/dynamodb/\" target=\"_blank\">DynamoDB</a>\n- Simple Email Service <a href=\"https://aws.amazon.com/ses//\" target=\"_blank\">SES</a>\n- <a href=\"https://aws.amazon.com/api-gateway/\" target=\"_blank\">API Gateway</a>\n\n## Set up the prerequisites\n\nSet up the prerequisites below to work with AWS Lambda functions using Ballerina.\n\n### Set up Ballerina\n\nInstall the [latest Ballerina distribution](https://ballerina.io/downloads/).\n\n### Set up the AWS CLI\n\nInstall the <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html\" target=\"_blank\">AWS CLI</a>.\n\n### Set up an AWS account\n\nFollow the steps below to set up an AWS account.\n\n1. Create an <a href=\"https://docs.aws.amazon.com/SetUp/latest/UserGuide/setup-AWSsignup.html\" target=\"_blank\">AWS account</a>.\n\n    >**Info:** For detailed instrucitons on creating an AWS account, see <a href=\"https://aws.amazon.com/getting-started/guides/setup-environment/module-one/\" target=\"_blank\">Module 1: Create Your AWS Account</a>.\n\n2. <a href=\"https://docs.aws.amazon.com/SetUp/latest/UserGuide/setup-rootuser.html\" target=\"_blank\">Sign in</a> to the AWS account you created.\n\n### Create a user\n\nFollow the steps below to create a new user in your AWS account.\n\n1. Create a <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console\" target=\"_blank\">new AWS user</a>.\n\n    >**Info:** Enter a username and enable access to the AWS Management Console.\n\n2. <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html#id_users_create_console\" target=\"_blank\">Set the permissions</a> to the created user.\n\n    >**Info:** Enable `AWSLambda_FullAccess` or higher permissions. \n\n3. Obtain the <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-authentication-user.html#cli-authentication-user-get\" target=\"_blank\">access keys</a>.\n\n4. Configure the <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-authentication-user.html#cli-authentication-user-configure.title\" target=\"_blank\">AWS CLI</a> for the user by providing the access key and secret generated in the user creation.\n\n### Create a role\n\nFollow the steps below to create a new role in your AWS account.\n\n1. Create a <a href=\"\" target=\"_blank\">new role</a>.\n\n2. <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html#roles-creatingrole-user-console\" target=\"_blank\">Set the permissions</a> to the created role.\n\n    >**Info:** Enable `AWSLambda_FullAccess` or higher permissions. \n\n3. Access the newly created role in the AWS Console, and copy the role ARN to use when the Lambda function is being deployed.\n\n## Write the function\n\nThe following Ballerina code gives an example of how to expose a simple echo function in AWS Lambda. \n\n```ballerina\nimport ballerina/log;\nimport ballerinax/awslambda;\n\n@awslambda:Function\npublic function echo(awslambda:Context ctx, json input) returns json {\n    log:printInfo(input.toJsonString());\n    return input;\n}\n```\n\nFunctions annotated as `@awslambda:Function` should always have the first parameter with the <a href=\"https://lib.ballerina.io/ballerinax/awslambda/latest#Context\" target=\"_blank\">`awslambda:Context`</a>object, which contains the information and operations related to the current function execution in AWS Lambda such as the request ID and the remaining execution time. \n\nThe second parameter with the `json` value contains the input request data. This input value format will vary depending on the source, which invoked the function (e.g., an AWS S3 bucket update event). The return type of the function is `json`. When the function is triggered by the event, the function body executes and it simply logs the input JSON and returns the JSON.\n\n## Build the function\n\nThe AWS Lambda functionality is implemented as a compiler extension. Thus, artifact generation happens automatically when you build a Ballerina module using the `bal build` command.\n\n## Deploy the function\n\nBallerina's AWS Lambda functionality is implemented as a custom AWS Lambda layer. This information is provided when the function is created. The compiler generates the `aws-ballerina-lambda-functions.zip` file, which encapsulates all the AWS Lambda functions that are generated. This ZIP file can be used with the AWS web console or the <a href=\"https://docs.aws.amazon.com/codedeploy/latest/userguide/getting-started-configure-cli.html\" target=\"_blank\">AWS CLI</a> to deploy the functions. \n\nTo deploy the function, execute the command, which you get in the CLI output logs after you [build the function](#build-the-function). For example, see the sample command below.\n\n**Info:** When you are deploying, make sure to replace the `$FUNCTION_NAME`, `$LAMBDA_ROLE_ARN`, and `$REGION_ID` placeholders with the corresponding values you obtained when [setting up the prerequisites](#set-up-the-prerequisites).\n\n```bash\n\tRun the following command to deploy each Ballerina AWS Lambda function:\n\taws lambda create-function --function-name $FUNCTION_NAME --zip-file fileb:///Users/user1/Desktop/aws_lambda_deployment/target/bin/aws-ballerina-lambda-functions.zip --handler aws_lambda_deployment.$FUNCTION_NAME --runtime provided --role $LAMBDA_ROLE_ARN --layers arn:aws:lambda:$REGION_ID:134633749276:layer:ballerina-jre11:6 --memory-size 512 --timeout 10\n\n\tRun the following command to re-deploy an updated Ballerina AWS Lambda function:\n\taws lambda update-function-code --function-name $FUNCTION_NAME --zip-file fileb://aws-ballerina-lambda-functions.zip\n```\n\n>**Info:**  For the supported parameters, go to the <a href=\"https://docs.aws.amazon.com/cli/latest/reference/lambda/create-function.html\" target=\"_blank\">`create-function` documentation</a>. You might need to change parameters such as the `MemorySize` and `Timeout` depending on your application and connection speed. \n\n## Invoke the function\n\nThe deployed AWS Lambda function can be tested by invoking it directly using the CLI. \n\n## Learn more\n\nIn a more practical scenario, the AWS Lambda functions will be used by associating them to an external event source such as Amazon DynamoDB or Amazon SQS. For more information on this, go to <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/invocation-eventsourcemapping.html\" target=\"_blank\">AWS Lambda event source mapping documentation</a>.\n\nFor examples on using AWS Lambda functions, see the below.\n\n- [Hello world](/learn/by-example/aws-lambda-hello-world/)\n- [Context execution](/learn/by-example/aws-lambda-context-execution/)\n- [S3 trigger](/learn/by-example/aws-lambda-s3-trigger/)\n- [DynamoDB trigger](/learn/by-example/aws-lambda-dynamodb-trigger/)\n\n<style> #tree-expand-all , #tree-collapse-all, .cTocElements {display:none;} .cGitButtonContainer {padding-left: 40px;} </style>\n","id":"aws-lambda","sub":"run-in-the-cloud","third":"function-as-a-service","slug":"run-in-the-cloud/function-as-a-service/aws-lambda","codes":"[[2032567263,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">import</span><span style=\\\"color: #24292E\\\"> ballerina/log;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">import</span><span style=\\\"color: #24292E\\\"> ballerinax/awslambda;</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">@</span><span style=\\\"color: #005CC5\\\">awslambda</span><span style=\\\"color: #24292E\\\">:</span><span style=\\\"color: #005CC5\\\">Function</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #D73A49\\\">public</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #D73A49\\\">function</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #6F42C1\\\">echo</span><span style=\\\"color: #24292E\\\">(</span><span style=\\\"color: #E36209\\\">awslambda</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #24292E\\\">Context ctx, </span><span style=\\\"color: #005CC5\\\">json</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #E36209\\\">input</span><span style=\\\"color: #24292E\\\">) </span><span style=\\\"color: #D73A49\\\">returns</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">json</span><span style=\\\"color: #24292E\\\"> {</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    log</span><span style=\\\"color: #D73A49\\\">:</span><span style=\\\"color: #6F42C1\\\">printInfo</span><span style=\\\"color: #24292E\\\">(input.</span><span style=\\\"color: #6F42C1\\\">toJsonString</span><span style=\\\"color: #24292E\\\">());</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">    </span><span style=\\\"color: #D73A49\\\">return</span><span style=\\\"color: #24292E\\\"> input;</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #24292E\\\">}</span></span></code></pre>\"],[-327914088,\"<pre class=\\\"shiki github-light\\\" style=\\\"background-color: #fff\\\" tabindex=\\\"0\\\"><code><span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">Run</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">the</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">following</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">command</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">to</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">deploy</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">each</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">Ballerina</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">AWS</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">Lambda</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">function:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">aws</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">lambda</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">create-function</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--function-name</span><span style=\\\"color: #24292E\\\"> $FUNCTION_NAME </span><span style=\\\"color: #005CC5\\\">--zip-file</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">fileb:///Users/user1/Desktop/aws_lambda_deployment/target/bin/aws-ballerina-lambda-functions.zip</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--handler</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">aws_lambda_deployment.</span><span style=\\\"color: #24292E\\\">$FUNCTION_NAME </span><span style=\\\"color: #005CC5\\\">--runtime</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">provided</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--role</span><span style=\\\"color: #24292E\\\"> $LAMBDA_ROLE_ARN </span><span style=\\\"color: #005CC5\\\">--layers</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">arn:aws:lambda:</span><span style=\\\"color: #24292E\\\">$REGION_ID</span><span style=\\\"color: #032F62\\\">:134633749276:layer:ballerina-jre11:6</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--memory-size</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">512</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--timeout</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">10</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">Run</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">the</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">following</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">command</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">to</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">re-deploy</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">an</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">updated</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">Ballerina</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">AWS</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">Lambda</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">function:</span></span>\\n<span class=\\\"line\\\"><span style=\\\"color: #6F42C1\\\">aws</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">lambda</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">update-function-code</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #005CC5\\\">--function-name</span><span style=\\\"color: #24292E\\\"> $FUNCTION_NAME </span><span style=\\\"color: #005CC5\\\">--zip-file</span><span style=\\\"color: #24292E\\\"> </span><span style=\\\"color: #032F62\\\">fileb://aws-ballerina-lambda-functions.zip</span></span></code></pre>\"]]"},"__N_SSG":true}